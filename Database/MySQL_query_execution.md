# MySQL query execution
MySQL 쿼리 실행 과정

## MySQL 쿼리가 실행되는 과정
```text
SQL 요청 -> [MySQL 엔진 : 쿼리 파서 -> 전처리기 -> 옵티마이저 -> 쿼리 실행기] -> [스토리지 엔진] -> [MySQL 엔진 : 쿼리 실행기] -> SQL 결과 응답
```
1. 사용자는 SQL 문장을 MySQL 서버로 보낸다.
2. MySQL 서버는 쿼리 캐시를 확인한다. 데이터가 있으면 캐시 데이터를 반환한다. 그렇지 않으면 SQL 문장을 다음 단계로 전달한다.
3. MySQL 서버는 쿼리 실행 계획으로 SQL을 파싱, 전처리, 최적화한다.
4. 쿼리 실행 엔진은 스토리지 엔진의 API를 호출하여 그 계획을 실행한다.
5. MySQL 서버는 결과를 사용자에게 보낸다.

### 쿼리 캐시
가장 먼저 MySQL 서버는 쿼리 캐시(Query cache)를 확인한다. 쿼리 캐시에는 SELECT 문장만 저장할 수 있고 그 문장의 결과 집합도 함께 저장된다. 사용자가 요청한 쿼리 문장이 캐시에 있는 것과 동일한 경우 MySQL 서버는 그 데이터를 즉시 전달한다.

### 쿼리 파서
쿼리 파서(Query parser)는 사용자 요청으로 들어온 쿼리 문장을 MySQL이 이해할 수 있는 최소 단위의 어휘인 토큰으로 분리해 트리 형태의 구조로 만드는 작업을 수행한다. 쿼리 문장의 기본적인 문법 오류는 쿼리 파서에서 발견된다.

### 전처리기
전처리기(Preprocessor)는 파싱 과정에서 만들어진 파서 트리를 기반으로 쿼리 문장에 구조적인 문제점이 있는지 확인한다. 전처리기는 각 토큰에 테이블 이름, 컬럼 이름 등의 객체를 매핑해서 데이터베이스 객체가 존재하고 있는지, 접근 권한은 있는지 확인한다. 실제 존재하지 않거나 권한상 사용할 수 없는 객체의 토큰은 이 단계에서 걸러진다.

### 옵티마이저
옵티마이저(Optimizer)는 사용자의 요청으로 들어온 쿼리 문장을 저렴한 비용으로 어떻게 하면 가장 빠르게 처리할지 결정한다. 

### 실행 엔진
실행 엔진(Execution engine)은 옵티마이저가 세운 계획대로 각 스토리지 엔진에 요청하고 받은 결과를 또 다른 스토리지 엔진의 요청으로 보내주는 역할을 한다.

### 스토리지 엔진(핸들러)
스토리지 엔진(Storage engine)은 실행 엔진의 요청에 따라 데이터를 디스크로 저장하고 디스크로부터 데이터를 읽어 오는 역할을 한다. 핸들러라고도 부른다. MyISAM 테이블을 조작하는 경우 핸들러가 MyISAM 스토리지 엔진이 되고, InnoDB 테이블을 조작하는 경우에는 핸들러가 InnoDB 스토리지 엔진이 된다.

## 참고
https://shashwat-creator.medium.com/mysqls-logical-architecture-1-eaaa1f63ec2f  
Real MySQL 8.0 1권 4장  